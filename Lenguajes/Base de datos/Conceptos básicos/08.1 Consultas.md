# Cláusulas
## SELECT y FROM
[SQL SELECT Statement - W3 schools](https://www.w3schools.com/sql/sql_select.asp)
- <font style="color:#08F; font-weight:bold">Podemos consultar todos los registros de una tabla</font>:
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```sql
	SELECT * FROM nombre_tabla;
```
	 <font style="color:green">Ejemplo</font>:
	```sql
	SELECT * FROM clientes;
	```
	![[Pasted image 20250213190557.png]]
- <font style="color:#08F; font-weight:bold">También podemos consultar los registros de las columnas seleccionadas</font>:
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```sql
	SELECT columna1, columna2, ...
	FROM nombre_tabla;
```
	 <font style="color:green">Ejemplo</font>:
	```sql
	SELECT nombre, apellidos
	FROM clientes;
	```
	![[Pasted image 20250213190309.png]]
##  Acceder a una tabla de una base de datos diferente
- <font style="color:#08F; font-weight:bold">Podemos acceder a la tabla de una base de datos diferente</font>:
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```sql
	SELECT * FROM nombre_base_de_datos.nombre_tabla;
	```
	 <font style="color:green">Ejemplo</font>:
	```sql
	SELECT * FROM tienda.productos;
	```
	![[Pasted image 20250213203139.png]]
## Where
[SQL WHERE Clause - W3 schools](https://www.w3schools.com/sql/sql_where.asp)
- <font style="color:#08F; font-weight:bold">Podemos filtrar los registros de la consulta</font>:
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```sql
	SELECT * FROM nombre_tabla
	WHERE condición;
	```
	 <font style="color:green">Ejemplo</font>:
	```sql
	SELECT * FROM productos
	WHERE nombre="Leche Vaqui";
	```
	![[Pasted image 20250213193422.png]]
- <font style="color:#08F; font-weight:bold">Podemos filtrar los registros de la consulta</font>:
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```sql
	SELECT columna1, columna2, ...
	FROM nombre_tabla
	WHERE condición;
	```
	 <font style="color:green">Ejemplo con coincidencia de valor (id = 1)</font>:
	```sql
	SELECT id, nombre, stock
	FROM productos
	WHERE id=1;
	```
	![[Pasted image 20250213194152.png]]
	<font style="color:green">Ejemplo con condición true si el stock es inferior a 30</font>:
	```sql
	SELECT id, nombre, stock
	FROM productos
	WHERE stock < 30;
	```
	![[Pasted image 20250213194714.png]]
### Test de comparación
#### Operadores
- =
- <>
- <
- <=
- >
- >=
	<font style="color:green">Ejemplo con condición true si el stock es inferior a 30</font>:
	```sql
	SELECT id, nombre, stock
	FROM productos
	WHERE stock < 30;
	```
	![[Pasted image 20250213194714.png]]
### Test de rango
#### BETWEEN
- Es equivalente a `(A >= B) AND (A <= C)`.
- <font style="color:#08F; font-weight:bold">Devolver registros que SÍ están en un rango</font>:
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```SQL
	SELECT * FROM nombre_tabla
	WHERE nombre_columna BETWEEN valor1 AND valor2;
	```
	<font style="color:green">Ejemplo</font>:
	```sql
	SELECT * FROM productos
	WHERE stock BETWEEN 15 AND 80;
	```
	![[Pasted image 20250213205854.png]]
- <font style="color:#08F; font-weight:bold">Devolver registros que NO están en un rango</font>:
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```SQL
	SELECT * FROM nombre_tabla
	WHERE nombre_columna NOT BETWEEN valor1 AND valor2;
	```
	<font style="color:green">Ejemplo</font>:
	```sql
	SELECT * FROM productos
	WHERE stock NOT BETWEEN 15 AND 80;
	```
	![[Pasted image 20250213211144.png]]
### Test de pertenencia a conjunto
#### IN
- `X IN (A, B, C)` es completamente equivalente a: 
	`(X = A) OR (X = B) OR (X= C)`.
- <font style="color:#08F; font-weight:bold">Especificar múltiples valores en una cláusula WHERE</font>:
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```SQL
	SELECT * FROM nombre_tabla
	WHERE nombre_columna IN (valor1, valor2...);
	```
	<font style="color:green">Ejemplo</font>:
	```sql
	SELECT * FROM clientes
	WHERE dir_poblacion IN ("Almoradí", "Santomera");
	```
![[Pasted image 20250213212545.png]]
- <font style="color:#08F; font-weight:bold">NO mostrar los valores que pertenezcan a los múltiples valores en una cláusula WHERE</font>:
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```SQL
	SELECT * FROM nombre_tabla
	WHERE nombre_columna NOT IN (valor1, valor2...);
	```
	<font style="color:green">Ejemplo</font>:
	```sql
	SELECT * FROM clientes
	WHERE dir_poblacion NOT IN ("Almoradí", "Santomera");
	```
	![[Pasted image 20250213212815.png]]
### Test de correspondencia con patrón
[[09. Caracteres comodines.]]
- <font style="color:#08F; font-weight:bold">Realizar búsquedas con caracteres comodines y el operador LIKE</font>:
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```SQL
	SELECT * FROM nombre_tabla
	WHERE nombre_columna LIKE patron;
	```
	<font style="color:green">Ejemplo</font>:
	```SQL
	SELECT nombre, apellidos, dni 
	FROM clientes
	WHERE apellidos LIKE 'Mol%';
	```
	![[Pasted image 20250213214911.png]]
### Test de valor nulo (NULL)
- <font style="color:#08F; font-weight:bold">Encuentra las filas que tienen valores nulos</font>:
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```SQL
	SELECT columna1, columna2, ...
	FROM nombre_tabla
	WHERE nombre_columna IS NULL;
	```
	<font style="color:green">Ejemplo</font>:
	```SQL
	SELECT * FROM productos
	WHERE descripcion IS NULL;
	```
	![[Pasted image 20250213231145.png]]
- <font style="color:#08F; font-weight:bold">Encuentra las filas que NO tienen valores nulos</font>:
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```SQL
	SELECT columna1, columna2, ...
	FROM nombre_tabla
	WHERE nombre_columna IS NOT NULL;
	```
	<font style="color:green">Ejemplo</font>:
	```sql
	SELECT * FROM productos
	WHERE descripcion IS NOT NULL;
	```
	![[Pasted image 20250213231307.png]]
### Condiciones de búsquedas compuestas
#### OR
- Se utiliza para combinar dos condiciones de búsqueda cuando una o la otra (o ambas) deban ser ciertas.
- <font style="color:#08F; font-weight:bold">Encuentra filas con una condición TRUE</font>:
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```SQL
	SELECT columna1, columna2, ...
	FROM nombre_tabla
	WHERE condicion1 OR condicion2 OR condicion3 ...;
	```
	<font style="color:green">Ejemplo de mostrar productos con 15 o menos de stock o que tenga un precio de 2 o más</font>:
	```SQL
	SELECT * FROM productos
	WHERE stock <= 15 OR precio >= 2;
	```
	![[Pasted image 20250214174901.png]]
#### NOT
- Se utiliza para seleccionar filas en donde la condición de búsqueda es falsa.
- <font style="color:#08F; font-weight:bold">Encuentra filas con una condición TRUE</font>
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```SQL
	SELECT columna1, columna2, ...
	FROM nombre_tabla
	WHERE NOT condicion;
	```
	<font style="color:green">Ejemplo de mostrar productos que no cumplan con la condición de tener 15 o más de stock</font>:
	```SQL
	SELECT * FROM productos
	WHERE stock <= 15 OR precio >= 2;
	```
	![[Pasted image 20250214175803.png]]
## Columnas calculadas
- <font style="color:#08F; font-weight:bold">Columnas calculadas cuyos valores se calculan a partir de los valores de los datos almacenados</font>:
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```SQL
	SELECT columna1, columna2, (columna3 + columna4)
	FROM nombre_tabla;
	```
	<font style="color:green">Ejemplo de multiplicar el valor precio por el stock</font>:
	```SQL
	SELECT id, nombre, descripcion, (precio * stock)
	FROM productos;
	```
	![[Pasted image 20250214204641.png]]
### Agregar constantes como items
- <font style="color:#08F; font-weight:bold">Se puede agregar una constante como un item para que los resultados sean más fáciles de leer</font>:
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```SQL
	SELECT columna1, columna2, 'contante' (columna3 + columna4)
	FROM nombre_tabla;
	```
	<font style="color:green">Ejemplo de agregar una columna</font>:
	```SQL
	SELECT nombre, 'Precio total del stock', (precio * stock)
	FROM productos;
	```
	![[Pasted image 20250214204936.png]]
## Selección de todas las columnas
[[06. Tablas y columnas]]
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
```SQL
SELECT * FROM nombre_tabla;
```
## Excluir filas duplicadas (DISTINCT)
- <font style="color:#08F; font-weight:bold">Se pueden excluir filas que se repiten de en una consulta</font>:
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
```SQL
SELECT DISTINCT columna1, columna2, ...
FROM nombre_tabla;
```
## Ordenar resultado de una consulta (ORDER BY)
- <font style="color:#08F; font-weight:bold">Se puede ordenar el resultado de una consulta</font>:
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```SQL
	SELECT columna1, columna2, ...
	FROM nombre_tabla
	ORDER BY columna1;
	```
	<font style="color:green">Ejemplo</font>:
	```SQL
	SELECT * FROM productos
	ORDER BY stock;
	```
	![[Pasted image 20250214214726.png]]
- <font style="color:#08F; font-weight:bold">Ordenar de forma descendente con la palabra clave DESC</font>:
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```SQL
	SELECT columna1, columna2, ...
	FROM nombre_tabla
	ORDER BY columna1 DESC;
	```
	<font style="color:green">Ejemplo</font>:
	```SQL
	SELECT * FROM productos
	ORDER BY stock DESC;
	```
	![[Pasted image 20250214215037.png]]
## Combinación de resultados de una consulta (UNION)
- <font style="color:#08F; font-weight:bold">Se pueden combinar los resultados de varias consultas en una única tabla</font>:
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```SQL
	SELECT nombre_columna FROM tabla1
	UNION
	SELECT nombre_columna FROM tabla2;
	```
	<font style="color:green">Ejemplo</font>:
	```SQL
	SELECT id, nombre FROM productos
	UNION
	SELECT id, nombre FROM clientes
	ORDER BY nombre;
	```
	![[Pasted image 20250214220957.png]]
- <font style="color:#08F; font-weight:bold">Se pueden crear condiciones</font>:
	```SQL
	SELECT nombre_columna FROM tabla1 WHERE condicion
	UNION
	SELECT nombre_columna FROM tabla2 WHERE condicion;
	```
	<font style="color:green">Ejemplo</font>:
	```SQL
	SELECT id, nombre FROM productos  WHERE precio >= 3
	UNION
	SELECT id, nombre FROM clientes WHERE nombre LIKE 'J%'
	ORDER BY id;
	```
	![[Pasted image 20250214222003.png]]
## Consultas de resumen, GROUP BY, HAVING
- `SUM()`
	- Calcula el total de una columna.
- `AVG()`
	- Calcula el valor promedio de una columna.
- `MIN()`
	- Encuentra el valor más pequeño de una columna.
- `MAX()`
	- Encuentra el valor mayor de una columna.
- `COUNT()`
	- Cuenta el número de valores de una columna.
- `COUNT(*)`
	- Cuenta las filas de una consulta.
### `SUM()`
- <font style="color:#08F; font-weight:bold">Calcula la suma de una columna de valores de datos</font>:
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```SQL
	SELECT SUM(columna)
	FROM nombre_tabla
	WHERE condiciones;
	```
	<font style="color:green">Ejemplo</font>:
	```SQL
	SELECT SUM(precio)
	FROM productos;
	```
	![[Pasted image 20250215084629.png]]
### `AVG()`
- <font style="color:#08F; font-weight:bold">Calcula el valor promedio de una columna</font>:
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```SQL
	SELECT AVG(columna)
	FROM nombre_tabla
	WHERE condiciones;
	```
	<font style="color:green">Ejemplo</font>:
	```SQL
	SELECT AVG(precio)
	FROM productos;
	```
	![[Pasted image 20250215084817.png]]
<font style="color:green">Ejemplo. Mostrar el nombre y el precio del producto sólo cuando dicho precio sea igual o superior al precio medio de los productos. </font>
```SQL
SELECT Nombre, PrecioUnitario
FROM productos
WHERE PrecioUnitario >= (SELECT AVG(PrecioUnitario) FROM productos);
```
![[Pasted image 20250330135529.png]]
### `MIN()`
- <font style="color:#08F; font-weight:bold">Encuentra el valor más pequeño de una columna</font>:
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```SQL
	SELECT MIN(columna)
	FROM nombre_tabla
	WHERE condiciones;
	```
	<font style="color:green">Ejemplo</font>:
	```SQL
	SELECT MIN(precio)
	FROM productos;
	```
	![[Pasted image 20250215085032.png]]
### `MAX()`
- <font style="color:#08F; font-weight:bold">Encuentra el valor mayor de una columna</font>:
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```SQL
	SELECT MAX(columna)
	FROM nombre_tabla
	WHERE condiciones;
	```
	<font style="color:green">Ejemplo</font>:
	```SQL
	SELECT MAX(precio)
	FROM productos
	```
	![[Pasted image 20250215085220.png]]
### `COUNT()`
- <font style="color:#08F; font-weight:bold">Encuentra el numero de valores de una columna</font>:
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```SQL
	SELECT COUNT(columna)
	FROM nombre_tabla
	WHERE condiciones
	 ```
	<font style="color:green">Ejemplo</font>:
	```SQL
	SELECT COUNT(id)
	FROM productos
	WHERE stock BETWEEN 15 AND 80;
	 ```
	![[Pasted image 20250215085826.png]]
### `COUNT(*)`
- <font style="color:#08F; font-weight:bold">Cuenta el número de filas de una consulta</font>:
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```SQL
	SELECT COUNT(*)
	FROM nombre_tabla
	WHERE condiciones
	 ```
	<font style="color:green">Ejemplo</font>:
	```SQL
	SELECT COUNT(*)
	FROM productos
	WHERE precio BETWEEN 3 AND 10;
	 ```
	![[Pasted image 20250215091301.png]]
### Valores NULL
- <font style="color:#08F; font-weight:bold">COUNT ignorando los valores NULL</font>:
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```SQL
	SELECT COUNT(nombre_columna)
	FROM nombre_tabla
	WHERE condiciones;
	 ```
	<font style="color:green">Ejemplo</font>:
	```SQL
	SELECT COUNT(*)'id', COUNT(*)'nombre', COUNT(descripcion)'descripcion'
	FROM productos;
	 ```
	![[Pasted image 20250216094152.png]]
- <font style="color:#08F; font-weight:bold">COUNT no ignorando los valores NULL</font>:
	- Se suele utilizar `COUNT(*)` porque no ignora los valores NULL:
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```SQL
	SELECT COUNT(*)
	FROM nombre_tabla
	WHERE condiciones;
	 ```
	 <font style="color:green">Ejemplo</font>:
	```SQL
	SELECT COUNT(*)'id', COUNT(*)'nombre', COUNT(*)'descripcion'
	FROM productos;
	 ```
	![[Pasted image 20250216094530.png]]
##### <font style="color:salmon; font-weight:bold">Ignorar los valores NULL</font>:
- MIN() Y MAX():
	- Ignorar los valores NULL <font style="color:salmon; font-weight:bold">NO</font> tiene impacto.
- SUM():
	- Ignorar los valores NULL <font style="color:salmon; font-weight:bold">SÍ</font> tiene impacto.
### GROUP BY
[SQL GROUP BY Statement - W3schools](https://www.w3schools.com/sql/sql_groupby.asp)
- Se utiliza para agrupar resultados.
- Suele suele utilizar con funciones agregadas:
	- COUNT()
	- MAX()
	- MIN()
	- SUM()
	- AVG()
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```SQL
	SELECT nombre_columna
	FROM nombre_tabla
	WHERE condicion
	GROUP BY nombre_columna
	ORDER BY nombre_columna;
	 ```
	 <font style="color:green">Ejemplo</font>:
	- En la siguiente tabla vamos a agrupar los registros por supermercados sumando el stock de los productos.
	![[Pasted image 20250216105209.png]]
	```SQL
	SELECT SUM(stock), supermercado, COUNT(supermercado)'Numero_supermercados'
	FROM productos
	GROUP BY supermercado
	ORDER BY supermercado;
	 ```
	![[Pasted image 20250216110632.png]]
	
#### HAVING
- Al igual que la cláusula WHERE puede ser utilizada para seleccionar y rechazar filas individuales que participan en una consulta, la cláusula HAVING puede ser utilizada para seleccionar y rechazar grupos de filas.
- **Se utiliza para poner condiciones a GROUP BY.** Por lo que siempre se poner detrás de GROUP BY.
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```SQL
	SELECT nombre_columna
	FROM nombre_tabla
	WHERE condicion
	GROUP BY nombre_columna
	HAVING condicion
	ORDER BY nombre_columna;
	 ```
	<font style="color:green">Ejemplo de sumar los valores de la columna stock de la tabla productos, agruparlo por supermercados y devolver el registro que sume 50 o menos</font>:
	```SQL
	SELECT COUNT(id), SUM(stock), supermercado
	FROM productos
	GROUP BY supermercado
	HAVING SUM(stock) <= 50
	;
	 ```
	![[Pasted image 20250216151007.png]]
## CREATE VIEW
[SQL Views - W3schools](https://www.w3schools.com/sql/sql_view.asp)
- Se utiliza para crear vistas que se podrán consultar como si fueran tablas.
- Una vista es una representación virtual de los datos de una tabla.
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```SQL
	CREATE VIEW nombre_vista AS
	SELECT columna1, columna2, ...
	FROM table_name
	WHERE condicion;
	 ```
	<font style="color:green">Ejemplo de crear una vista de una consulta</font>:
	```SQL
	CREATE VIEW productos_poco_stock AS
	SELECT COUNT(id), SUM(stock), supermercado
	FROM productos
	GROUP BY supermercado
	HAVING SUM(stock) <= 50
	;
	 ```
	![[Pasted image 20250216173746.png]]
	- Consultamos los registros de la tabla:
		```SQL
		SELECT * FROM productos_poco_stock;
		 ```
		![[Pasted image 20250216173916.png]]
	- Los cambios que se realicen en la tabla **productos** pueden reflejarse en la vista creada **productos_poco_stock**.
## Optimización de consultas
### EXPLAIN
- Ofrece información sobre las tablas involucradas en la consulta.
	<font style="color:orange; font-weight:bold">Sintaxis</font>:
	```SQL
	EXPLAIN SELECT columna1, columna2
	FROM nombre_tabla
	WHERE condicion;
	 ```
	<font style="color:green">Ejemplo</font>:
	```SQL
	EXPLAIN SELECT id, nombre
	FROM productos
	WHERE precio > 2;
	 ```
![[Pasted image 20250216181629.png]]
