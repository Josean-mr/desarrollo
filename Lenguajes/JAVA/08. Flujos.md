# Flujos
- Un flujo es un objeto que hace de intermediario entre el programa, y el origen o el destino de la información.
![[Pasted image 20250220191945.png]]
# Excepciones
- En JAVA hay **2 tipos principales de excepciones**:
	- Verificadas (checked exceptions).
	- No verificadas (unchecked excepctions).
## <font style="color:#08f">Clase Throwable</font>
- Es la clase base de todas las clases que representan excepciones y errores.
	<font style="color:#08f;font-weight:bold">Clase Exception</font>:
	- Es una **subclase de la clase Throwable**.
	- **Representa excepciones** que pueden ser controladas y recuperadas durante la ejecución del programa.
	<font style="color:#08f;font-weight:bold">Clase Error</font>:
	- Es una **subclase de la clase Throwable**.
	- **Representa problemas más graves** que generalmente están f**uera del control del programador**.
	<font style="color:orange;font-weight:bold">Jerarquía</font>:
	![[Pasted image 20250220193802.png]]
## <font style="color:#08f">Bloque try-catch</font>
- Construcción en Java que se utiliza para manejar excepciones.
- Si ocurre una excepción en el bloque "try", se desvia el flujo del programa a "catch".
<font style="color:orange;font-weight:bold">Sintaxis</font>:
```java
try {
/* Aquí se incluyen las operaciones que podrían
generar excepciones, como operaciones de I/O,
división por cero, acceso a elementos fuera de los
límites de un array, entre otros*/
} catch (TipoDeExcepcion e) {
/* Manejo de la excepción.
Si ocurre una excepción dentro del bloque "try", el
flujo del programa se desviará automáticamente
aquí*/
}
```

- "e" es el nombre de la variable que se utiliza para acceder a la información relacionada con la excepción.
## <font style="color:#08f">Bloque try-finally</font>
- El bloque de "finally" se ejecutará siempre (se de una excepción o no).
- Se utiliza cunado se necesita que ciertos recursos sean liberados o acciones sean tomadas al final de una sección del código.
<font style="color:orange;font-weight:bold">Sintaxis</font>:
```java
try {
// Código que puede lanzar una excepción
} finally {
// Código que se ejecutará siempre, ya sea que haya
//ocurrido una excepción o no.
}
```
### <font style="color:purple">Tipos de excepciones</font>:
<font style="color:#08f;font-weight:bold">NumberFormatException</font>
- Comprueba si los caracteres son númericos.
- <font style="color:green;font-weight:bold">Ejemplo:</font>
	```java
	public class Excepciones {
	
		public static void main(String[] args) {
	
			// Declarar variable tipo String
			
			String str=" 12 ";
			
			/*
			Declarar variable tipo int para intentar convertir la
			variableString en tipo int
			*/
			int numero;
			
			/* Bloque try-catch para intentar la conversión.
			En caso de no poder realizarse se ejecutará el bloque catch.
			*/
			try {
				numero=Integer.parseInt(str);
			// Excepción del tipoNumberFormatException
			} catch(NumberFormatException ex) { 
			System.out.println("No es un número -> " + ex);
			}
	
		}
	
	}
	
	```
	- Imprimirá en consola:
		```console
		No es un número -> java.lang.NumberFormatException: 
		For input string: " 12 "
		```
<font style="color:#08f;font-weight:bold">ArithmeticException</font>
- Comprueba si es posible la operación aritmética. Por ejemplo, si se divide un número entre 0.
- <font style="color:green;font-weight:bold">Ejemplo:</font>
	```java
	public class Excepciones {

		public static void main(String[] args) {

			// Declaración de variables

			int dividendo = 10;
			
			int divisor = 0;
			
			/*
			
			* Bloque try-catch para intentar la división.
			* En caso de no poder realizarse se ejecutará
			* el bloque catch.
			*/

			try {
			
			double resultado = dividendo / divisor;
			
			} catch(ArithmeticException ez) {
			
			System.out.println("La división no es correcta -> " +
			ez.getMessage);
			}
			
		}
			
	}
	```
	- Imprimirá en consola:
		```console
		La división no es correcta -> / by zero
		```
<font style="color:#08f;font-weight:bold">FileNotFoundException</font>
- Se lanza **cuando intentamos acceder a un archivo que no existe** en el sistema.
<font style="color:#08f;font-weight:bold">IOException</font>
- Excepción que puede ocurrir durante **operaciones entrada/salida**, como leer o escribir un archivo.
<font style="color:#08f;font-weight:bold">EOFException</font>
- Subclase de IOException.
- Significa "End of File".
- Se produce cuando se llega al final de un flujo de entrada y se intenta leer más datos.
- Muy utilizada cuando se trabaja con archivos binarios.
## <font style="color:#08f">Lanzar una excepción con throw (lanzar)</font>
- El **programador puede lanzar una excepción** para comunicar que ha ocurrido una situación inusual o un error que debe ser manejado en un lugar diferente del código:
- Al lanzar una excepción, **se permite que el control del programa pase al bloque try-catch**.
- **Se crea una instancia de una clase excepción** y se enviará a lo largo del flujo de ejecución.
- **Lanzar una excepción**:
	- Utilizar la **palabra clave throw (lanzar)** seguida de una instancia de la clase de excepción que deseamos enviar.
		- Posibles instancias de clase:
			- throw new ArithmeticException
			- throw new NumberFormatException
			- ...
	- <font style="color:green;font-weight:bold">Ejemplo:</font>
Clase EjemploExcepciónThrow.java
```java
public class EjemploExcepcionThrow {

	public void dividir() {

		// Declaración de variables
		int dividendo = 10;
		int divisor = 0;

		// Se intenta hacer la división dentro del bloque try-catch
		try {
		/*
		* Si el divisor es 0 se lanza la excepción con un mensaje
		* personalizad y se continua el código en el bloque catch.
		*/

			if (divisor == 0) {
			
			throw new ArithmeticException("No se puede dividir por cero.");
			
			}

		// Si el divisor no es 0, se realiza la división.
		int resultado = dividendo / divisor;

		// Se imprime el resultado
		System.out.println("Resultado de la división: " + resultado);

		} catch (ArithmeticException e) {
		// Se captura y se maneja la excepción en caso de que ocurra
		System.out.println("Error aritmético: " + e.getMessage());

		}

	}

}
```
Invocación del método desde el metodo Main
```java
public class Excepciones {
	public static void main(String[] args) {

		/*
		* Creación de instancia de clase
		*/
		EjemploExcepcionThrow ejemplo = new EjemploExcepcionThrow();
		
		// Invocación del procedimiento.
		ejemplo.dividir();

	}

}
```
Imprimirá en consola:
```console
Error aritmético: No se puede dividir por cero.
```
# Concepto de flujos de E/S
- Flujo de **entrada/salida** (I/O stream, Input/Output stream):
	- Representa una fuente desde la cual se reciben datos o un destino hacia el cual se envían datos.
- Un flujo de datos puede **provenir o dirigirse** a:
	- Archivos en disco.
	- Dispositivos de comunicaciones.
	- Otros programas o arrays en memoria.
- Los **datos pueden ser**:
	- **Bytes**.
	- **Tipos primitivos**.
	- **Caracteres** propios de un idioma local.
	- **Objetos**.
## <font style="color:#08f">Flujos de bytes (byte streams)</font>
- Realizan operaciones de entrada y salida basándose en bytes (8 bits).
- Paquete **java.io**:
	- Las clases de flujos de bytes descienden (heredan) de las clases **InputStream** y **OutputStream**.
	- Las clases **FileInputStream** y **FileOutputStream** manipulan flujos de bytes provenientes o dirigidos hacia archivos en disco. Se utilizan para realizar operaciones de entrada y salida (I/O) de bytes desde y hacia archivos.
	![[Pasted image 20250222093815.png]]
	![[Pasted image 20250222093825.png]]
- <font style="color:green;font-weight:bold">Ejemplo:</font>
```java
package teoria;

import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;

public class FlujoBytes {

    /*
     * Método principal que puede lanzar una excepción
     * de tipo IOException
     */
    public static void main(String[] args) throws IOException {

        /* Declaración de objetos para lectura y
        escritura de archivos en bytes */
        FileInputStream in = null;
        FileOutputStream out = null;

        String respuesta;

        // Nombres de los archivos de origen y destino
        String ficheroOrigen = "ficheroOrigen.txt";
        String ficheroDestino = "ficheroDestino.txt";

        /* Obtener la ruta de trabajo actual y
        formar las rutas de los archivos */
        String rutaFicheroALeer = System.getProperty("user.dir")
        + "\\" + ficheroOrigen;
        String rutaFicheroAEscribir = System.getProperty("user.dir")
        + "\\" + ficheroDestino;

        // Obtener el nombre del sistema operativo
        String sistemaOperativo = System.getProperty("os.name");

        System.out.println("Sistema operativo: " + sistemaOperativo);
        
        System.out.println("La ruta de trabajo es: "
        + rutaFicheroALeer);

        try {
            /*
             * Se crean los flujos de entrada y salida, 
             * instanciando los objetos FileInputStream y
             * FileOutputStream para leer y escribir en archivos.
             */
            in = new FileInputStream(rutaFicheroALeer);
            out = new FileOutputStream(rutaFicheroAEscribir);

            int c;
            /* Leer y escribir cada byte hasta llegar
            al final del archivo (-1) */
            while ((c = in.read()) != -1) {
                out.write(c);
            }
        } catch (IOException ex) {
            respuesta = "El fichero de lectura origen " +
            ficheroOrigen + " no existe. Debes crearlo antes.";
            
            System.out.println(respuesta);
        } finally {
            // Cerrar los flujos si fueron abiertos
            if (in != null) in.close();
            if (out != null) out.close();
        }
    }
}
```
Imprimirá en consola:
```console
Sistema operativo Linux

La ruta de trabajo es /home/andres/Dropbox/0.DAW/Curso1/Programacion/workspace/Unidad5Teoria\ficheroOrigen.txt

El fichero de lectura origen ficheroOrigen.txt no existe, debes crearlo antes
```
## <font style="color:#08f">Flujos de caracteres</font>
- Clases para los flujos de caracteres: **FileReader** y **FileWriter**.
![[Pasted image 20250222113625.png]]
<font style="color:purple;font-weight:bold">Leer líneas de archivo</font>:
	<font style="color:#08f;font-weight:bold">BufferedReaded</font>:
		- Se utiliza el método **readLine()** dentro de un bluque while para leer una línea completa en cada iteración.
<font style="color:purple;font-weight:bold">Escribir líneas de archivo</font>:
	<font style="color:#08f;font-weight:bold">BufferedWriter</font>:
		- Utiliza un buffer interno.
		- Adecuado para grandes cantidades de datos y para escribir de forma repetida.
		- Cuenta con mejor rendimiento que PrintWriter.
	<font style="color:#08f;font-weight:bold">PrintWriter</font>:
		- Adecuado para escribir datos formateados o para buscar simplicidad y comodidad.
- <font style="color:green;font-weight:bold">Ejemplo:</font>
```java
package teoria;

import java.io.BufferedReader;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.io.PrintWriter;

public class FlujoLineas {

	/*
	* Definir el método principal indicando que el método puede
	* lanzar una excepción de tipo IOException
	*/	
	public static void main(String[] args) throws IOException {
		// Declaración de objetos tipo BufferedReader y PrintWriter
		BufferedReader in = null;
		PrintWriter out = null;

		String respuesta;
		String ficheroOrigen = "archivo.txt";
		
		/*
		* Intentar leer y escribir los ficheros. En caso de excepción
		* se ejecuta el bloque catch
		*/
		try {
			// Crear los flujos de entrada y salida
			in = new BufferedReader(new FileReader("archivo.txt"));
			out = new PrintWriter(new FileWriter("CopiaLineas.txt"));

			/* Cada línea del archivo se guarda en una
			variable de tipo String */
			String linea;
			
			while ((linea = in.readLine()) != null) {
			out.println(linea);
			}
		} catch (IOException ex) {
			respuesta = "El fichero de lectura origen " + ficheroOrigen
			+ " no existe, debes crearlo antes";

			System.out.println(respuesta);

		} finally {
			if (in != null)
				in.close();
			if (out != null)
				out.close();
		
		}
		
	}
		
}
```
Imprimirá en consola:
```console
El fichero de lectura origen archivo.txt no existe, debes crearlo antes
```
# Entrada/salida desde la línea de comandos
## <font style="color:#08f">Entrada estandar</font>:
- **System.in**:
	```java
	// Lee bytes y los pasa a caracteres Unicode
	InputStreamReader cin = new InputStreamReader(System.in);
	```
## <font style="color:#08f">Salida estandar</font>:
- **System.out**:
	```java
	// Lee bytes y los pasa a caracteres Unicode
	System.out.println();
	```
## <font style="color:#08f">Mensajes de error</font>:
- **System.err**:
![[Pasted image 20250222130811.png]]
- <font style="color:green;font-weight:bold">Ejemplo:</font>
```java
package teoria;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;

public class EntraraSalidaLineaComandos {

	public static void main(String[] args) throws IOException {
	
		/*
		* Declarar objeto BufferedReader para leer entrada de teclado
		*/
		BufferedReader stdin = null;
		
		System.out.print("Introduzca caracteres y pulse Return: ");
		
		/*
		* Inicializar el BufferedReader con un InputStreamReader
		* que lee desde System.in
		*/
		stdin = new BufferedReader(new InputStreamReader(System.in));
		
		// Variable que almacenará la línea introducida
		String linea = null;
		
		try {
			// Leer la línea desde la entrada estándar
			linea = stdin.readLine();
		} catch (IOException e) {
		
			// Manejo de excepción en caso de error de E/S
			e.printStackTrace();
		}
		
		// Verificar si se ha leído correctamente la linea
		if (linea != null) {
			System.out.println("Ha escrito:" + linea);
		} else { 
			System.out.println("No se ha escrito línea porque ha "
			+ "habido una excepción"); 
		}
		
		// Cerrar el BufferReader si fue abierto correctamente.
		if (stdin != null)
			stdin.close();
	
	}
	
}
```
Imprimirá en consola:
```console
Introduzca caracteres y pulse Return: hola
Ha escrito:hola
```
# Flujos de datos
- Soportan tipos de datos:
	- Primitivo:
		- boolean
		- char
		- byte
		- short
		- int
		- long
		- float
		- double
	- Cadena de caracteres:
		- String
## <font style="color:#08f">Introducir y extraer datos</font>:
<font style="color:green;font-weight:bold">Ejemplo:</font>
```java
package teoria;

import java.io.BufferedOutputStream;
import java.io.BufferedInputStream;
import java.io.DataInputStream;
import java.io.DataOutputStream;
import java.io.FileOutputStream;
import java.io.FileInputStream;
import java.io.EOFException;
import java.io.IOException;

public class FlujoDatos {
    // Nombre del archivo donde se escribirán los datos
    static String archDatos = "Factura.txt";

    /* Array de precios donde se almacenan los
     * precios de los diferentes artículos */
    static final double[] precios = {18.00, 160.00, 25.00, 14.00, 2.50};
    /* Array de cantidades de cada artículo */
    static final int[] cants = {4, 2, 1, 4, 50};
    /* Array de artículos */
    static final String[] items = {"Marcador Azul",
		"Papel A4 500 hojas", "Borrador", "DVD", "Sobres A4"};

    public static void main(String[] args) throws IOException {
        DataOutputStream out = null;
        try {
            /* Crear una cadena de flujos que permite
             * escribir datos en un archivo de texto */
            out = new DataOutputStream(new BufferedOutputStream
            		(new FileOutputStream(archDatos)));

            /* Iniciar bucle que recorre los arrays y
             * escribe los datos en el archivo */
            for (int i = 0; i < precios.length; i++) {
                out.writeDouble(precios[i]); // Escribir el precio 
                out.writeInt(cants[i]); // Escribir la cantidad
                out.writeUTF(items[i]); // Escribir el nombre
            }
        } catch (IOException ex) {
        	// Mensaje de error en caso de fallo
            System.out.println("Error E/S: " + ex.getMessage());
        } finally {
        	// Cerrar el flujo de salida si fue abierto.
            if (out != null) {
                out.close();
            }
        }
        
        // Declaración de flujo de entrada
        DataInputStream in = null;
        // Variable para almacenar el total de la factura
        double total = 0.0;
        try {
        	// Crear flujo para leer los datos de archivo
            in = new DataInputStream(new BufferedInputStream
            		(new FileInputStream(archDatos)));
            
            double precio;
            int cant;
            String item;

            try {
            	/* Bucle infinito para leer los datos hasta
            	 * que se alcance el final del archivo */
                while (true) {
                    precio = in.readDouble(); // Leer el precio
                    cant = in.readInt(); // Leer la cantidad
                    item = in.readUTF(); // Leer el nombre
                    
                    // Imprimir los datos en formato tabular
                    System.out.format(" %4d %25s a %6.2fE c/u %8.2fE%n",
                    		cant, item, precio, cant * precio);
                    
                    // Acumular el total de la factura.
                    total += cant * precio;
                }
            } catch (EOFException e) {
                System.out.format("\t\t\t\t\t TOTAL %8.2fE%n", total);
            }
        } finally {
            if (in != null) {
                in.close();
            }
        }
    }
}
```
![[Pasted image 20250222182356.png]]

### <font style="color:salmon">Explicación</font>:
1. **Escritura en el archivo (`DataOutputStream`)**
    - Se abre un flujo de salida (`DataOutputStream`) para escribir los datos en el archivo `"Factura.txt"`.
    - Se recorren los arreglos (`precios`, `cants`, `items`) y se escriben los valores en el archivo en formato binario.
    - Se maneja cualquier error de entrada/salida (`IOException`) y se cierra el flujo en el bloque `finally`.
2.  **Lectura del archivo (`DataInputStream`)**
    - Se abre un flujo de entrada (`DataInputStream`) para leer los datos guardados en el archivo.
    - Se usa un bucle infinito `while (true)`, donde se leen los datos en el mismo orden en que fueron escritos.
    - Se imprimen los datos en un formato tabular utilizando `System.out.format()`.
    - Cuando se llega al final del archivo, se captura la excepción `EOFException` y se imprime el total acumulado.
    - Se cierra el flujo en el bloque `finally` para evitar fugas de recursos.
### <font style="color:salmon">Cadena de formato</font>:
- **%4d**: Especifica que se reemplazará con un número entero (d) ocupando al menos 4 caracteres. Si el número tiene menos de 4 dígitos, se añadirán espacios en blanco a la izquierda para completar los 4 caracteres.
- **%25s**: Especifica que se reemplazará con una cadena (s) ocupando al menos 25 caracteres. Si la cadena tiene menos de 25 caracteres, se añadirán espacios en blanco a la derecha para completar los 25 caracteres.
- **%6.2f€**: Especifica que se reemplazará con un número de punto flotante (f) ocupando al menos 6 caracteres, con 2 decimales. El símbolo "€" indica que se trata de una cantidad monetaria.
- **%8.2f€**: Especifica que se reemplazará con un número de punto flotante (f) ocupando al menos 8 caracteres, con 2 decimales. El símbolo "€" indica que se trata de una cantidad monetaria.
- **%n**: Especifica un carácter de nueva línea, que se utiliza para cambiar de línea en la salida.
# Flujos de objetos
- Los métodos de entrada/salida que estaban disponibles para flujos de datos primitivos estarán implementados tambié para flujos de objetos.
## <font style="color:#08f">Clases de flujos de objetos</font>:
- ObjectInputStream.
- ObjectOutputStream.
## <font style="color:#08f">Instancias de la clase File</font>:
- Las instancias de la clase File representan nombres de archivo y no los archivos en sí.
- Operaciones:
	- **delete()** borra el archivo inmediatamente;
	- **deleteOnExit()** lo borra cuando finaliza la ejecución de la máquina virtual Java.
	- **setLastModified()** permite fijar la fecha y hora de modificación del archivo:
		```java
		new File("factura.txt").setLastModified(newDate().getTime());
		```
	- **renameTo()** permite renombrar el archivo.
	- **mkdir()** crea un directorio, mkdirs() también, pero crea los directorios superiores si no existen
	- **list()** y **listFiles()** listan el contenido de un directorio. list() devuelve un array de String con los nombres de los archivos, listFiles() devuelve un array de objetos File.
	- **createTempFile()** crea un nuevo archivo con un nombre único y devuelve un objeto File que apunta a él. Es útil para crear archivos temporales, que luego se borran, asegurándose de tener un nombre de archivo no repetido.
	- **listRoots()** devuelve una lista de nombres de archivo correspondientes a la raíz de los sistemas de archivos. En Microsoft Windows serán de formato a:\ y c:\, en UNIX, MacOS y Linux será el directorio raíz único /.
# Ficheros de acceso aleatorio. Clase RandomAccessFile
- Un archivo de acceso aleatorio permite leer o escribir datos en forma no secuencial.
- El acceso aleatorio es más eficiente que el acceso secuencial.
- La clase **java.io.RandomAccessFile** implementa las interfaces **DataInput** y **DataOutput**, lo cual permite leer y escribir en el archivo.
- Se debe indicar también si se abrirá para **lectura** o también para **escritura**.
```java
//Archivo de solo lectura
RandomAccessFile f1 = new RandomAccessFile("archiuno.txt","r");

//Archivo de lectura/escritura
RandomAccessFile f2 = new RandomAccessFile("archidos.txt","rw")
```
- La clase RandomAccessFile maneja un puntero al archivo (file pointer). Este puntero indica la posición actual en el archivo.
- Además de los métodos de entrada/salida que ajustan el puntero automáticamente, la clase RandomAccessFile tiene métodos específicos para manipular el puntero al archivo:
	- **int skipBytes(int)**: mueve el puntero hacia adelante la cantidad especificada de bytes.
	- **void seek(long)**: ubica el puntero justo antes del byte especificado en el entero long.
	- **long getFilePointer()**: devuelve la posición actual del puntero, el número de byte indicado por el entero long devuelto.
- [JAVA: RandomAccessFile DAM - DAW](https://youtu.be/ZusJ9y_bEe8?si=V6_gzu_oPMLTTrSw)
- [Ejercicios propuestos y resueltos de ficheros en Java](https://www.discoduroderoer.es/ejercicios-propuestos-y-resueltos-de-ficheros-en-java/)
# Interfaces gráficas
## <font style="color:#08f">JavaFX</font>:
[Link de descarga](https://openjfx.io/)
[Configuración JAVAFX](https://openjfx.io/openjfx-docs/)